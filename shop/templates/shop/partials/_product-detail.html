<!-- {% load static %}
<link rel="stylesheet"  id="swappable-stylesheet" href="{% static 'shop/css/product-detail.css' %}"
hx-swap-oob="true"
> -->
<main id="main-container" class="container section page-product-detail">
    <div id="product-detail" class="product-detail">
    <section class="gallery">
        <div class="gallery__main">
        <img src="{{current.image_url}}" alt="Product main">
        </div>
        <div class="gallery__thumbs">
            {% for variant in variants %}
                {% if variant == current %}
                <div style="border: 2px solid blue;" class="gallery__thumb">
                {% else %}
                <div class="gallery__thumb">
                {% endif %}
                    <img src="{{variant.image_url}}" alt="Thumb 1">
                </div>                
            {% endfor %}
        </div>
    </section>
    
    <section class="detail-panel">
        <div class="badge">New arrival</div>
        <h1 style="margin:0;">{{product_name}}</h1>
        <div class="product-card__meta">
        <strong style="font-size:1.4rem;">${{current.unit_price}}</strong>
        <strong style="color: red;"> {{current.quantity}} remaining </strong>
        <span class="rating">
            <svg class="star" viewBox="0 0 24 24"><polygon points="12 2 15.1 8.4 22 9.2 17 14.1 18.3 21 12 17.5 5.7 21 7 14.1 2 9.2 8.9 8.4 12 2"/></svg>
            4.8 (142 reviews)
        </span>
        </div>
        <p class="section__subtitle">Tailored in Northern Italy with a breathable wool blend and soft shoulder construction.</p>

        <form 
        id="variant-form"
        class="options"
        hx-get="{% url 'shop:product-detail' product_slug %}"
        hx-trigger="change"
        hx-swap="outerHTML transition:true show:top"
        hx-push-url="true"
        hx-select="#product-detail"
        hx-target="#product-detail"
        >
            <div class="option-row">
                <label class="form__label" for="color">Color</label>
                <select id="color" class="form__control" name="color">
                    {% for color in colors %}
                    <option
                        {% if color == current.color %}
                        selected
                        {% endif %}
                    > {{color}} </option>
                    {% endfor %}
                </select>
            </div>
            <div class="option-row">
                <label class="form__label" for="size">Size</label>
                <select id="size" class="form__control" name="size">
                    {% for size in sizes %}
                    <option 
                        {% if size == current.size %}
                        selected
                        {% endif %}

                        {% if not size in available_sizes %}
                            style="color:rgb(123, 121, 121)"
                            disabled
                        {% endif %}

                    > {% if not size in available_sizes %} 
                    {{size}}(unavailble)
                    {% else %}
                    {{size}}
                    {% endif %}
                    </option>
                    {% endfor %}
                </select>
            </div>
            <div class="option-row">
                <span class="form__label">Quantity</span>
                <div class="quantity">
                <button 
                class="quantity__btn"
                type="button"
                hx-post="{% url 'shop:decrease-quantity' product_slug %}"
                hx-target="#quantity_count"
                hx-push-url="false"
                hx-swap="outerHTML"
                hx-select="unset"
                >-</button>
                <span
                id = "quantity_count"
                > 
                {{product_quantity}}
                </span>
                <button 
                hx-swap="outerHTML"
                class="quantity__btn" 
                type="button"
                hx-post="{% url 'shop:increase-quantity' product_slug %}"
                hx-target="#quantity_count"
                hx-push-url="false"
                hx-select="unset"
                >+</button>
                </div>
            </div>
        </form>

        <div class="cta-row">
        <button 
        class="btn btn--primary" 
        type="button"
        id="detail-add-to-cart"
        hx-select="unset"
        hx-post="{% url 'shop:add-to-cart' %}"
        hx-include="#variant-form"
        hx-vals = '{
            "id": "{{product_id}}",
            "name": "{{product_name}}",
            "image_url": "{{current.image_url}}",
            "price":"{{current.unit_price}}",
            "slug": "{{product_slug}}",
            "image_id":"{{current.image_id}}",
            "curr_total_quantity": "{{current.quantity}}",
            "quantity_requested":"",
            "from":"detail" 
        }'
        hx-target="#cart-count-top"
        hx-swap="outerHTML settle:1s"
        
        >Add to cart</button>
        <button class="btn btn--ghost" type="button">Save for later</button>
        </div>

        <div class="specs">
        <strong>Highlights</strong>
        <ul>
            <li>Soft shoulder, half-lined for breathability</li>
            <li>Horn buttons, interior media pocket</li>
            <li>Certified mills with responsible sourcing</li>
        </ul>
        </div>
    </section>
    </div>

    <section class="section">
    <h2 class="section__title">Product details</h2>
    <p class="section__subtitle">Designed for boardrooms and after-hours gatherings with ease of movement.</p>
    <table class="table">
        <tbody>
        <tr>
            <th scope="row">Fabric</th>
            <td>Wool blend with recycled poly lining</td>
        </tr>
        <tr>
            <th scope="row">Fit</th>
            <td>Tailored, true to size</td>
        </tr>
        <tr>
            <th scope="row">Care</th>
            <td>Dry clean; steam to refresh</td>
        </tr>
        <tr>
            <th scope="row">Origin</th>
            <td>Made in Italy</td>
        </tr>
        </tbody>
    </table>
    </section>

    <section class="section reviews">
    <div class="section__header">
        <div>
        <h2 class="section__title">Reviews</h2>
        <p class="section__subtitle">Balanced rating from professionals and frequent travelers.</p>
        </div>
        <div class="badge">4.8 average</div>
    </div>
    <div class="grid">
        <article class="review-card">
        <div class="testimonial-card__profile">
            <img class="avatar" src="https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=200&q=80" alt="Reviewer">
            <div>
            <strong>Daniel Ruiz</strong>
            <p class="section__subtitle">Operations, Logistics</p>
            </div>
        </div>
        <p>"Lightweight yet structured. The navy tone pairs well with most of my work staples."</p>
        </article>
        <article class="review-card">
        <div class="testimonial-card__profile">
            <img class="avatar" src="https://images.unsplash.com/photo-1521572267360-ee0c2909d518?auto=format&fit=crop&w=200&q=80" alt="Reviewer">
            <div>
            <strong>Sofia Martens</strong>
            <p class="section__subtitle">Consultant</p>
            </div>
        </div>
        <p>"Excellent drape and interior pocketing. Runs true to size with room for a knit layer."</p>
        </article>
    </div>
    </section>

    <section class="section related">
    <div class="section__header">
        <h2 class="section__title">Related products</h2>
        <a class="nav-link" href="products.html">View all</a>
    </div>
    <div class="grid grid--three">
        {% for product in related_products %}
            <a class="card product-card" href="{% url 'shop:product-detail' product.slug %}">
            <div class="product-card__image">
                <img src="/media/{{product.first_image_for_cover}}" alt="{{product.name}}">
            </div>
            <h3 class="product-card__title">{{product.name}}</h3>
            <div class="product-card__meta">
                <span>${{product.details.0.unit_price}}</span>
                <span class="rating">
                <svg class="star" viewBox="0 0 24 24"><polygon points="12 2 15.1 8.4 22 9.2 17 14.1 18.3 21 12 17.5 5.7 21 7 14.1 2 9.2 8.9 8.4 12 2"/></svg>
                4.7
                </span>
            </div>
            </a>
        {% endfor %}
    </div>
    </section>
</main>
