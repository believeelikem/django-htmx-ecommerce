{% with p=products %}
    <div id="pagination_nums" class="pagination" hx-boost="true">
        {% if p.has_previous %}
            <a 
                class="pagination__item"

                href="{% url 'shop:home' %}?page=1" 
                hx-push-url = "true"
                hx-vals='{
                    "from_paginated":"true"
                }'
                hx-target = "#pagination_nums"
                hx-swap = "outerHTML transition:true"
                >First
            </a>
        {% endif %}
      
        <a  
            
            class="
            pagination__item
            {% if not p.has_previous %}
                disabled
            {% endif %}
            "

href="{% url 'shop:home' %}?page={% if p.has_previous %}{{p.previous_page_number}}{% else %}1{% endif %}" 
            
            hx-push-url = "true"
            hx-vals='{
                "from_paginated":"true"
            }'
            hx-target = "#pagination_nums"
            hx-swap = "outerHTML transition:true"
            > <<
        </a>
        
        {% for page_num in p.paginator.page_range %}
            {% if page_num >= p.number|add:'-2' and page_num <= p.number|add:'2'  %}

                    <a 
                    
                    class="pagination__item
                    {% if page_num == p.number %}
                    pagination__item--active {% endif %}"

                    href="{% url 'shop:home' %}?page={{page_num}}" 
                    hx-push-url = "true"
                    hx-vals='{
                        "from_paginated":"true"
                    }'
                    hx-target = "#pagination_nums"
                    hx-swap = "outerHTML transition:true"
                    >{{page_num}}
                    </a>

            {% endif %}
        {% endfor %}

            <a 
                
                class="
                pagination__item
                {% if not p.has_next %}
                disabled
                {% endif %}
                "
href="{% url 'shop:home' %}?page={% if p.has_next %}{{p.next_page_number}}{% else %}1{% endif %}" 
                
                hx-push-url = "true"
                hx-vals='{
                    "from_paginated":"true"
                }'
                hx-target = "#pagination_nums"
                hx-swap = "outerHTML transition:true"
                > >>
            </a>

            {% if p.has_next %}
                <a 
                
                    class="pagination__item"

                    href="{% url 'shop:home' %}?page={{p.paginator.num_pages}}" 
                    hx-push-url = "true"
                    hx-vals='{
                        "from_paginated":"true"
                    }'
                    hx-target = "#pagination_nums"
                    hx-swap = "outerHTML transition:true"
                    >Last
                </a>
            {% endif %}

    </div>
{% endwith %}

<div 
id="products_list"
class="grid grid--four" 
hx-boost="true"
hx-target="body"
hx-swap="outerHTML transition:true"
hx-swap-oob="true"
>
    {% for product in products %}
    <article class="card product-card">
    
    <a 
    class="product-card__link" 
    hx-push-url="true"
    href="{% url 'shop:product-detail' product.slug %}"
    >   
        <div class="product-card__image">
        <img src="{{product.first_image_for_cover}}" alt="Structured blazer">
        </div>
        <h3 class="product-card__title">{{product.name}}</h3>
        <div class="product-card__meta">
        <span>${{product.details.0.unit_price}}</span>
        <span class="rating">
            <svg class="star" viewBox="0 0 24 24"><polygon points="12 2 15.1 8.4 22 9.2 17 14.1 18.3 21 12 17.5 5.7 21 7 14.1 2 9.2 8.9 8.4 12 2"/></svg>
            4.8
        </span>
        </div>
    </a>
    <button  
    class="btn btn--secondary" 
    type="button"
    hx-post="{% url 'shop:add-to-cart' %}"
    hx-vals = '{
        "id": "{{ product.id }}",
        "name": "{{ product.name}}",
        "image_url": "{{ product.first_image_for_cover }}",
        "image_id": "{{ product.details.0.image_id}}",
        "price": "{{ product.details.0.unit_price }}",
        "color": "{{ product.details.0.color }}",
        "curr_total_quantity": "{{ product.details.0.quantity }}",
        "quantity_requested":"",
        "size": "{{ product.details.0.size }}",
        "slug": "{{ product.slug }}",
        "from": "index"
    }'
    hx-target="#cart-count-top"
    hx-swap="outerHTML"
    >Add to cart <span id="cart-counter-on-product-{{product.id}}" class="btn__counter">{{product.quantity_in_cart}}</span></button>
    </article>
    {% endfor %}
</div>