<main id="main-container" class="container section page-product-detail">
    <section class="section related">
        <div class="section__header">
            <h2 class="section__title">{{category.name}} products</h2>
        </div>
        <div class="grid grid--three" hx-boost="true">
        {% for product in category_products %}
            <article class="card product-card">
            
            <a 
            class="product-card__link" 
            hx-push-url="true"
            href="{% url 'shop:product-detail' product.slug %}"
            >   
                <div class="product-card__image">
                <img src="/media/{{product.first_image_for_cover}}" alt="Structured blazer">
                </div>
                <h3 class="product-card__title">{{product.name}}</h3>
                <div class="product-card__meta">
                <span>${{product.details.0.unit_price}}</span>
                <span class="rating">
                    <svg class="star" viewBox="0 0 24 24"><polygon points="12 2 15.1 8.4 22 9.2 17 14.1 18.3 21 12 17.5 5.7 21 7 14.1 2 9.2 8.9 8.4 12 2"/></svg>
                    4.8
                </span>
                </div>
            </a>
            <button  
            class="btn btn--secondary" 
            type="button"
            hx-post="{% url 'shop:add-to-cart' %}"
            hx-vals = '{
                "id": "{{ product.id }}",
                "name": "{{ product.name}}",
                "image_url": "{{ product.first_image_for_cover }}",
                "image_id": "{{ product.details.0.image_id}}",
                "price": "{{ product.details.0.unit_price }}",
                "color": "{{ product.details.0.color }}",
                "curr_total_quantity": "{{ product.details.0.quantity }}",
                "quantity_requested":"",
                "size": "{{ product.details.0.size }}",
                "slug": "{{ product.slug }}",
                "from": "index"
            }'
            hx-target="#cart-count-top"
            hx-swap="outerHTML"
            >Add to cart <span id="cart-counter-on-product-{{product.id}}" class="btn__counter">{{product.quantity_in_cart}}</span></button>
            </article>
        {% endfor %}
        </div>
    </section>
</main>
